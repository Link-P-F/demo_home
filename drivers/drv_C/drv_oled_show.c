#include "oled.h"
#include "drv_oled_show.h"
#include <math.h>
#include "FreeRTOS.h"
#include "task.h"
#include "drv_sht20.h"

u8 start[]  = { 
	0X00,0X40,0X20,0X10,0X10,0X80,0X40,0XC0,0XD0,0XA0,0XE0,0XF0,0XD8,0XE8,0XFC,0XFC,
	0XFE,0XFE,0XFE,0XFE,0XFA,0XFF,0X8D,0X95,0X05,0X25,0X8D,0X9E,0XFA,0XFE,0XF6,0XFE,
	0XFC,0XFC,0XEC,0XF8,0XF0,0XB0,0X60,0XC0,0X80,0X0E,0XB2,0X62,0X16,0X04,0X10,0X80,
	0X00,0X00,0X06,0X20,0X40,0X80,0X02,0X1C,0X1E,0X3F,0X3B,0X7F,0X7F,0XFF,0X3F,0X3F,
	0X3F,0X7F,0X7F,0X7F,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFE,0XFF,0XFF,0XFF,0XFF,
	0X7F,0X7F,0X7F,0X3F,0X3F,0X3F,0X7F,0XFF,0X03,0X9B,0X07,0X13,0X02,0X02,0X45,0X00,
	0X98,0X01,0XC6,0X00,0X00,0X00,0XFC,0XE1,0XFF,0XFF,0X7F,0X0E,0X07,0X03,0X01,0X00,
	0X00,0X40,0X00,0X00,0X00,0X40,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X04,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X01,0X03,0X06,0X1C,0X6C,0XD0,
	0X10,0XE8,0XF3,0X11,0X02,0X00,0X00,0X00,0X07,0X7F,0XFF,0X01,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X01,0X80,0XC0,0XC0,0XC0,0XC4,0X80,0X00,0X00,0X80,0X00,0X00,0X00,
	0XE0,0X00,0X80,0XC0,0XE6,0XC0,0XC8,0X80,0X00,0X01,0X10,0X00,0X00,0X00,0X00,0X00,
	0X00,0XB9,0XFF,0X1F,0X03,0X00,0X00,0X00,0X00,0X10,0X28,0X60,0X41,0X06,0X00,0X00,
	0XA0,0X10,0X00,0X10,0X12,0X07,0X01,0X0F,0X01,0X06,0X06,0X07,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X04,0X07,0X04,0X06,0X17,0X01,0X81,0X02,0X12,0X00,0X00,0X38,
	0XA1,0X00,0X02,0X07,0X40,0XA8,0X00,0X00,0X00,0X00,0X00,0X3C,0X41,0X18,0X00,0X00,
	0X80,0X86,0X87,0X02,0X00,0X00,0X10,0X10,0X10,0XF8,0XFA,0XCA,0X8E,0X8E,0X7C,0XFC,
	0XE0,0XC0,0XC0,0XE0,0XFC,0XFC,0X8C,0XCE,0XCE,0XDA,0XF9,0X79,0X28,0X20,0X10,0X10,
	0X0C,0X46,0X80,0X80,0X80,0X00,0X00,0X40,0X03,0X00,0X00,0X00,0X38,0X04,0X00,0X08,
	0X1C,0X20,0X00,0X08,0X28,0X20,0X08,0X3C,0X00,0X00,0X38,0X20,0X81,0X95,0XB9,0X95,
	0X81,0XAD,0X89,0X99,0X8D,0X81,0X81,0X81,0XB1,0X81,0X81,0X89,0X81,0X00,0X00,0X08,
	0X00,0X20,0X00,0X00,0X00,0X00,0X38,0X00,0X00,0X00,0X00,0X00,0X00,0X30
};



u8 ni[] = {//你
	0x40,0x20,0xF8,0x07,0x10,0x0C,0x87,0x04,0xE4,0x04,0x84,0x14,0x0C,0x00,0x00,0x00,
	0x3F,0x00,0x08,0x06,0x21,0x20,0x3F,0x00,0x00,0x03,0x0C,0x00
};

u8 hao[] = {//好
	0x88,0x78,0x0F,0x08,0xF8,0x00,0x42,0x42,0x42,0xF2,0x4A,0x46,0x40,0x00,0x20,0x11,
	0x0A,0x06,0x19,0x00,0x00,0x20,0x20,0x3F,0x00,0x00,0x00,0x00
};

u8 gantanhao[] = {0x00,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x00,0x00,0x00,0x00};//!

u8 wo[] = {//我
	0x10,0x12,0x12,0xFE,0x91,0x91,0x10,0x10,0xFF,0x10,0x12,0xD4,0x10,0x00,0x02,0x22,
	0x21,0x3F,0x00,0x00,0x20,0x10,0x0B,0x04,0x0B,0x10,0x3C,0x00
};

u8 shi[] = {//是
	0x40,0x40,0x5F,0x55,0x55,0x55,0xD5,0x55,0x55,0x55,0x5F,0x40,0x40,0x00,0x20,0x10,
	0x0F,0x10,0x20,0x20,0x3F,0x22,0x22,0x22,0x22,0x20,0x20,0x00
};

u8 ke[] = {//可
	0x02,0x02,0xF2,0x12,0x12,0x12,0x12,0xF2,0x02,0x02,0xFE,0x02,0x02,0x00,0x00,0x00,
	0x07,0x02,0x02,0x02,0x02,0x03,0x20,0x20,0x3F,0x00,0x00,0x00
	};

u8 li[] = {//莉
	0x84,0xA4,0xA4,0xE4,0x9F,0x94,0x84,0x04,0xEF,0x04,0x04,0xF4,0x04,0x00,0x08,0x04,
	0x02,0x3F,0x02,0x04,0x08,0x00,0x07,0x20,0x20,0x3F,0x00,0x00};

u8 logo[] = {
	0XE0,0XF8,0X1C,0X06,0X06,0X03,0X03,0X01,0XC1,0X11,0XC1,0XC1,0XE1,0XF1,0XFB,0XF9,
	0XE5,0XF7,0XF3,0XF3,0XF3,0XF3,0XF3,0XF7,0XF7,0XF7,0XF7,0XEF,0X67,0X6F,0X17,0X11,
	0X51,0X11,0X11,0X31,0X31,0X21,0X61,0X41,0X01,0X01,0X01,0X01,0X01,0X01,0X01,0X01,
	0X01,0X81,0X01,0X01,0X01,0X01,0X01,0X01,0X03,0X03,0X03,0X06,0X06,0X1C,0X78,0XE0,
	0XFF,0X00,0X00,0X00,0X00,0X00,0XE8,0XFE,0XFF,0XFF,0XF1,0XFD,0XFF,0XFF,0XFF,0XFF,
	0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFE,0XFE,0XFE,0XFC,0XFD,0XFC,0XFC,
	0XFC,0XDC,0XC0,0X60,0X60,0XF1,0XB0,0XF2,0XFC,0XFC,0XF8,0XFF,0X7C,0X00,0X01,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X80,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,
	0XFF,0X01,0X00,0XF0,0XFE,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XE7,
	0X03,0X03,0X03,0X03,0X05,0X01,0X03,0X11,0X17,0X0F,0X0F,0X1F,0X3F,0X7F,0XFF,0XFF,
	0XFE,0XFF,0XFF,0X7F,0X3F,0X3F,0X7F,0XFF,0XFF,0XFB,0XFD,0X0F,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X01,0X00,0X00,0X00,0X00,0X00,0XFF,
	0XFF,0XE0,0X00,0X19,0X63,0XFF,0XFF,0XFF,0XFF,0XA1,0X3F,0XFF,0XB9,0XB3,0X7F,0XFF,
	0XFE,0XFC,0X84,0X02,0X02,0X10,0X18,0X18,0X38,0X78,0X18,0X18,0X00,0X00,0X00,0X01,
	0X03,0X07,0X00,0X00,0X00,0X00,0XC0,0XF1,0XFF,0X3F,0X03,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X4E,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,
	0XFF,0X03,0X00,0X00,0X00,0XCF,0X1F,0X7F,0XFF,0X3F,0X63,0X83,0X0F,0X2D,0X03,0X01,
	0X00,0X01,0X03,0X07,0X0F,0X08,0X10,0X10,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X03,0XFF,0X05,0X07,0X02,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0XE0,0X60,0X60,0X40,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,
	0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X01,0X00,0X00,0X00,0X00,0X00,0X00,0X20,
	0X20,0X20,0X30,0XB0,0XF0,0XE0,0XE0,0XC0,0X80,0X80,0XC0,0XC0,0XE0,0X00,0X00,0XC0,
	0X00,0X00,0X00,0X00,0X00,0X00,0X01,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X3C,0XC0,0XC0,0XC0,0X80,0X00,0X00,0X00,0X00,0X00,0X00,0XBF,0XFF,
	0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X48,0X00,0X00,0X00,0X00,0X41,
	0X41,0X01,0X00,0X00,0X67,0XE7,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XF8,0XF0,0XE0,
	0XC0,0X80,0X00,0X00,0X00,0X00,0X00,0X80,0X80,0X80,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X03,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0X3E,0X0E,0X03,0XC3,0XFF,
	0X07,0X1F,0X38,0X60,0X60,0XC0,0XC0,0X80,0X80,0XC0,0XF8,0XF8,0XE0,0X80,0X80,0X80,
	0X80,0X80,0X80,0X80,0X80,0X8C,0XFF,0XF3,0XD8,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,
	0XFF,0XFF,0XDF,0XDF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0X80,0X80,0X80,0X80,0X80,0X80,
	0X80,0X80,0X80,0X80,0X80,0X81,0X8F,0XCF,0XC7,0XC3,0XC1,0X60,0X70,0X38,0X1F,0X07
};

u8 pika[] = {
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X80,0XF0,0XF8,0XF8,0XF0,0XE0,0X80,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X80,0XC0,0XE0,0XF0,0XF0,0XF8,0XF8,0XFC,0XFC,0X38,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X80,0X80,0X80,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0XFF,0XFF,0X7F,0X1F,0X0F,0X07,0X0F,0XFE,0XF0,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XC0,0XF0,0X78,0X1C,0X0E,0X07,
	0X03,0X01,0X80,0XE1,0XFF,0X7F,0X1F,0X07,0X01,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0XF0,0XFF,0X0F,0X03,0X07,0X0E,0X0C,0X38,0X70,0XE0,0XC0,0X80,
	0X00,0X00,0X07,0X3F,0XF8,0XC0,0X00,0X00,0X00,0X00,0X3F,0X3F,0X38,0X18,0X18,0X0C,
	0X0C,0X0C,0X0C,0X04,0X06,0X06,0X04,0X0C,0X0C,0X0F,0X03,0X00,0X20,0X70,0XF8,0X98,
	0X0C,0X06,0X07,0X01,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X7F,0XEF,0XC0,0X80,0X00,0X00,0X00,0X00,0X00,0X00,0X01,0X07,
	0X0E,0X1C,0X38,0XF0,0XC1,0XC3,0XFF,0XFE,0X06,0X00,0X00,0XE0,0XF0,0XD0,0XE0,0X00,
	0X00,0X00,0X00,0X40,0X00,0X00,0X00,0X00,0X18,0X34,0X3C,0X3C,0X80,0XC0,0XC1,0XDF,
	0XFE,0XE0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X01,0X01,0X03,0X07,0X06,0X0E,0X0C,0X18,0X38,0XF0,
	0XE0,0X60,0X00,0XC0,0XF1,0X7F,0X1F,0X7F,0XFE,0XFE,0XFE,0XFE,0XBC,0X80,0X00,0X00,
	0X00,0X02,0X02,0X02,0X01,0X83,0X81,0X80,0X80,0XC0,0XC0,0XC2,0X6F,0X7F,0X3F,0X7F,
	0XFF,0X01,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X02,0X07,
	0X07,0X0C,0X0F,0X0F,0X1F,0XFE,0XFE,0XFC,0XFC,0XFF,0X0F,0X01,0X81,0X83,0X03,0X03,
	0X0B,0XBB,0XF3,0X43,0X43,0XF3,0X19,0X05,0X01,0X00,0X80,0X80,0X00,0X00,0X00,0X00,
	0X0F,0XFF,0XF0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X01,0X3F,0XFF,0XC0,0X80,0X00,0X00,0X01,0X03,0X03,
	0X03,0X03,0X01,0XC0,0XC0,0X81,0X83,0X03,0X03,0X01,0X01,0X00,0X00,0X00,0X80,0XC0,
	0XF0,0X7F,0X1F,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X1F,0X1F,0X1F,0X0F,0X0F,0X0F,0X07,
	0X07,0X03,0X03,0X01,0X01,0X01,0X01,0X03,0X03,0X03,0X07,0X0F,0X0F,0X1F,0X1F,0X1F,
	0X0E,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00
};


void drv_oled_start(void)
{
	taskENTER_CRITICAL();
	OLED_Clear();
	OLED_ShowPicture(39, 0, 50, 50, start, 1);
	
	OLED_ShowPicture(15, 50, 14, 14, ni, 1);
	OLED_ShowPicture(31, 50, 14, 14, hao, 1);
	
	OLED_ShowPicture(55, 50, 14, 14, wo , 1);
	OLED_ShowPicture(71, 50, 14, 14, shi , 1);
	OLED_ShowPicture(87, 50, 14, 14, ke , 1);
	OLED_ShowPicture(103, 50, 14, 14, li , 1);
	
	OLED_Refresh();
	taskEXIT_CRITICAL();
}

extern int status[8];
void drv_oled_status_1(void)
{
	taskENTER_CRITICAL();
	OLED_Clear();
	OLED_ShowString(0,2,"LED1:",16,1);//led1
	if(status[0] == 0)
	{
		OLED_ShowString(60,2,"OFF ",16,1);
	}
	else
	{
		OLED_ShowString(60,2,"O N ",16,1);
	}
	
	OLED_ShowString(0,18,"LED2:",16,1);//led2
	if(status[1] == 0)
	{
		OLED_ShowString(60,18,"OFF ",16,1);
	}
	else
	{
		OLED_ShowString(60,18,"O N ",16,1);
	}
	
	OLED_ShowString(0,34,"LED3:",16,1);//led3
	if(status[2] == 0)
	{
		OLED_ShowString(60,34,"OFF",16,1);
	}
	else
	{
		OLED_ShowString(60,34,"O N",16,1);
	}
	
	OLED_ShowString(0,50,"LEDD2:",16,1);//ledD2
	if(status[3] == 0)
	{
		OLED_ShowString(60,50,"OFF ",16,1);
	}
	else
	{
		OLED_ShowString(60,50,"O N ",16,1);
	}

	OLED_Refresh();
	taskEXIT_CRITICAL();
	vTaskDelay(pdMS_TO_TICKS(2000));
}

void drv_oled_status_2(void)
{
	taskENTER_CRITICAL();
	OLED_Clear();

	OLED_ShowString(0,2,"BEEP:",16,1);//beep
	if(status[4] == 0)
	{
		OLED_ShowString(60,2,"OFF ",16,1);
	}
	else
	{
		OLED_ShowString(60,2,"O N ",16,1);
	}
	
	OLED_ShowString(0,18,"FAN:",16,1);//fan
	if(status[5] == 0)
	{
		OLED_ShowString(60,18,"OFF ",16,1);
	}
	else if(status[5] == 1)
	{
		OLED_ShowString(60,18,"GEAR 1",16,1);
	}
	else if(status[5] == 2)
	{
		OLED_ShowString(60,18,"GEAR 2",16,1);
	}
	else if(status[5] == 3)
	{
		OLED_ShowString(60,18,"GEAR 3",16,1);
	}
	
	OLED_ShowString(0,34,"SHT20:",16,1);//sht20
	if(status[6] == 0)
	{
		OLED_ShowString(60,34,"OFF ",16,1);
	}
	else if(status[6] == 1)
	{
		OLED_ShowString(60,34,"TEM",16,1);
	}
	else if(status[6] == 2)
	{
		OLED_ShowString(60,34,"HUM",16,1);
	}
	else if(status[6] == 3)
	{
		OLED_ShowString(60,34,"TEM&HUM",16,1);
	}
	OLED_Refresh();
	taskEXIT_CRITICAL();
	vTaskDelay(pdMS_TO_TICKS(2000));
}

void drv_oled_status_3(double tem, double hum)
{
	if(status[6] != 0 )
	{
		taskENTER_CRITICAL();
		OLED_Clear();
		if(status[6] == 1 || status[6] == 3)
		{
			OLED_ShowString(0,0,"TEMP:",16,1);
			OLED_ShowNum(50, 0, (u32)tem, 2, 16, 1);
			OLED_ShowChar(70, 0, '.', 16, 1);
			OLED_ShowNum(80, 0, (u32)((tem-floor(tem))*10), 2, 16, 1);
			OLED_ShowChar(100, 0, 'C', 16, 1);
		}
		if(status[6] == 2 || status[6] == 3)
		{
			OLED_ShowString(0, 16, "HUM:", 16, 1);       // 前缀
			OLED_ShowNum(50, 16, (u32)hum, 2, 16, 1);     // 整数部分60
			OLED_ShowChar(70, 16, '.', 16, 1);            // 小数点
			OLED_ShowNum(80, 16, (u32)((hum-floor(hum))*10), 2, 16, 1);  // 小数部分2
			OLED_ShowChar(100, 16, '%', 16, 1); 
		}
		OLED_Refresh();  // 刷新显示
		taskEXIT_CRITICAL();
		vTaskDelay(pdMS_TO_TICKS(2000));
	}
}

void drv_oled_logo(void)
{
	taskENTER_CRITICAL();
	OLED_Clear();
	OLED_ShowPicture(0, 0, 64, 64, logo, 1);
	OLED_ShowPicture(64, 0, 64, 64, pika, 1);
	OLED_Refresh();  // 刷新显示
	taskEXIT_CRITICAL();
	vTaskDelay(pdMS_TO_TICKS(1000));
}



